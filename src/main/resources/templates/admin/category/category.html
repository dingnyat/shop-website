<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/admin_layout}">
<head>
  <meta charset="UTF-8">
  <title>Category</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<section layout:fragment="content_body">
  <div class="container" style="margin-top: 15px;">
    <div class="row">
      <div class="col-sm-3">
        <h2>Table Category</h2>
      </div>
      <div class="col-sm-6">
        <div class="container">
          <button type="button" class="btn btn-primary" id="btn-add" data-toggle="modal" data-target="#category-modal">
            Add
          </button>
          <!-- The Modal Add category-->
          <div class="modal fade" id="category-modal">
            <div class="modal-dialog modal-dialog-scrollable">
              <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h4 class="modal-title">Category Information</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body -->
                <form class="form-signin" action="" method="">
                  <div class="modal-body">
                    <div class="content">
                      <div class="container-fluid">
                        <div class="row">
                          <div class="col-md-12">
                            <div class="content table-responsive table-full-width">
                              <div>
                                <div class="wrapper">
                                  <label>Code:</label>
                                  <input type="text"
                                         class="form-control" id="cate_code"
                                         name="cate_code"
                                         style="background-color: #edd7e7"/>
                                  <label>Name:</label>
                                  <input type="text"
                                         class="form-control" id="cate_name"
                                         name="cate_name"
                                         style="background-color: #edd7e7"/>
                                </div>
                              </div>
                            </div>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Modal footer -->
                  <div class="modal-footer">
                    <div class="row">
                      <div class="col-lg-8"></div>
                      <div class="col-lg-2"></div>
                      <div class="col-lg-2">
                        <button type="button" id="btn-save" class="btn btn-success"
                                data-dismiss="modal">Save
                        </button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr>
    <table class="table table-bordered" id="tableCate">
      <thead>
      <tr>
        <th>ID</th>
        <th>Code</th>
        <th>Name</th>
        <th>Select</th>
      </tr>
      </thead>
      <tbody id="bodyTableCate">
      </tbody>
    </table>
  </div>
  <!--Modal Edit category-->
  <div class="modal fade" id="category-modal-edit">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Category Information</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <!-- Modal body -->
        <form class="form-signin" action="" method="">
          <div class="modal-body">
            <div class="content">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-12">
                    <div class="content table-responsive table-full-width">
                      <div>
                        <div class="wrapper">
                          <label>Code:</label>
                          <input type="text"
                                 class="form-control" id="cate_code_edit"
                                 name="cate_code"
                                 style="background-color: #edd7e7"/>
                          <label>Name:</label>
                          <input type="text"
                                 class="form-control" id="cate_name_edit"
                                 name="cate_name"
                                 style="background-color: #edd7e7"/>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Modal footer -->
          <div class="modal-footer">
            <div class="row">
              <div class="col-lg-8"></div>
              <div class="col-lg-2"></div>
              <div class="col-lg-2">
                <button type="button" id="btn-edit-save" class="btn btn-success"
                        data-dismiss="modal">Save
                </button>
              </div>
            </div>

          </div>
        </form>
      </div>
    </div>
  </div>
  <!--Modal status-->
  <div class="modal fade" role="dialog" id="category-action-status-modal">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content text-center">
        <div class="model-header">
          <h3 class="modal-title">Status</h3>
        </div>
        <div class="modal-body">
          <p id="category-action-status"></p>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <!-- The Modal Confirm Delete Category -->
    <div class="modal fade" id="confirm-modal">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h4 class="modal-title">Confirmation</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <!-- Modal body -->
          <form class="form-signin">
            <div class="modal-body">
              <div class="content">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="wrapper">
                        <span>Do you want to delete this category?</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
              <div class="row">
                <button type="button" id="delete-confirm" class="btn btn-danger mx-1"
                        data-dismiss="modal">Delete
                </button>
                <button type="button" id="btn-cancel" class="btn btn-warning mx-1"
                        data-dismiss="modal">Cancel
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <script>
      let category;

      window.onload = function () {
          let saveBtn = document.getElementById("btn-save");

          document.getElementById("btn-add").onclick = function () {
              document.getElementById("cate_code").value = "";
              document.getElementById("cate_name").value = "";
              saveBtn.innerHTML = "Add";
          };

          saveBtn.onclick = function (ev) {
              let categoryCode = document.getElementById("cate_code").value;
              let categoryName = document.getElementById("cate_name").value;
              category = {id: null, code: categoryCode, name: categoryName};
              ajaxCategory(category, "/admin/category/add");
          };

          document.getElementById("btn-edit-save").onclick = function (ev) {
              category['name'] = document.getElementById("cate_name_edit").value;
              category['code'] = document.getElementById("cate_code_edit").value;
              ajaxCategory(category, "/admin/category/edit");
          };

          showTableCategory();
      };

      function ajaxCategory(category, url) {
          let req = new XMLHttpRequest();
          req.open("post", url, true);
          req.setRequestHeader("Content-Type", "application/json");
          req.onreadystatechange = function () {
              if (req.readyState !== 4) {
                  return;
              }
              if (req.status !== 200) {
                  document.getElementById('category-action-status').innerHTML = "Error! Can't connect to server";
                  $("#category-action-status-modal").modal("show");
              } else {
                  document.getElementById('category-action-status').innerHTML = this.responseText;
                  $("#category-action-status-modal").modal("show");
                  showTableCategory();
              }
          };
          req.send(JSON.stringify(category));
      }

      function deleteCategory(categoryId) {
          let req = new XMLHttpRequest();
          req.open("get", "/admin/category/delete/" + categoryId, true);
          req.onreadystatechange = function () {
              if (req.readyState !== 4) {
                  return;
              }
              if (req.status !== 200) {
                  document.getElementById('category-action-status').innerHTML = "Error! Can't connect to server";
                  $("#category-action-status-modal").modal("show");
              } else {
                  showTableCategory();
                  document.getElementById('category-action-status').innerHTML = this.responseText;
                  $("#category-action-status-modal").modal("show");
              }
          };
          req.send(null);
      }

      function showTableCategory() {
          let dataTable = document.getElementById('bodyTableCate');
          dataTable.innerHTML = "";
          let req = new XMLHttpRequest();
          req.open('post', '/admin/category/list', true);
          req.onreadystatechange = function () {
              if (req.readyState !== 4) {
                  return;
              }
              if (req.status !== 200) {
                  document.getElementById('category-action-status').innerHTML = "Error! Can't connect to server";
              } else {
                  let categories = JSON.parse(this.responseText);
                  let text = '';
                  for (let i = 0; i < categories.length; i++) {
                      let cate = categories[i];
                      text += "<tr>" + "<td>" + cate.id + "</td>"
                          + "<td>" + cate.code + "</td>"
                          + "<td>" + cate.name + "</td>"
                          + "<td>" +
                          "<button type='button' id='btn-edit' class='btn btn-primary mx-1' onclick='showEditDialog(" + cate.id + ")'" + " data-toggle='modal' data-target='#category-modal-edit'>Edit</button>" +
                          "<button type='button' onclick='showDeleteDialog(" + cate.id + ")'" + " id='btn-delete' class='btn btn-danger mx-1'>Delete</button>"
                          + "</td>"
                          + "</tr>";
                  }
                  dataTable.innerHTML = text;
              }
          };
          req.send(null);
      }

      function showDeleteDialog(categoryId) {
          $("#confirm-modal").modal("show");
          document.getElementById("delete-confirm").onclick = function (ev) {
              deleteCategory(categoryId);
          }
      }

      function showEditDialog(categoryId) {
          document.getElementById("btn-edit").innerHTML = "Edit";
          let req = new XMLHttpRequest();
          req.open('get', '/admin/category/' + categoryId);
          req.onreadystatechange = function () {
              if (req.readyState !== 4) {
                  return;
              }
              if (req.status !== 200) {
                  document.getElementById('category-action-status').innerHTML = "Error! Can't connect to server";
                  $("#category-action-status-modal").modal("show");
              } else {
                  category = JSON.parse(this.responseText);
                  document.getElementById("cate_code_edit").value = category.code;
                  document.getElementById("cate_name_edit").value = category.name;
                  $("#category-modal-edit").modal("show");
              }
          };
          req.send(null);
      }
  </script>
</section>
</body>
</html>